import{j as e,a as V,m as _,n as K,o as Z,p as Ie,i as de,q as ze,s as xe,r as m,t as Pe,X as O,u as L,v as De,w as Me,f as me,x as Re,y as $,z as T,S as Le,D as he,c as z,h as P,A as U,F as H,U as J,E as $e,G as X,l as E,I as Q,J as ue,M as Y,Q as ge,K as be,N as pe,O as Oe,V as ee,k as R,W as Fe,Y as He,Z as fe,_ as je,$ as se,a0 as Ve,a1 as _e,a2 as Ue,a3 as Be,T as ye,a4 as te,e as We,a5 as qe,a6 as Ge}from"./vendor-BGAm2JFI.js";import{u as C,R as f,a as Je,g as Qe,r as Ke,m as Ze,i as Xe,H as Ye}from"./core-CNLpyEEB.js";import{S as es,P as ss,N as ts,D as rs,a as Ne,b as ve,c as we,d as Se,E as as,e as ls}from"./forms-FxYF851u.js";import{P as ns,a as os,E as is,V as cs,b as ds,S as xs,D as ms}from"./print-D5Sx_sRd.js";import"./libs-DnC4bF5A.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))t(c);new MutationObserver(c=>{for(const i of c)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function a(c){const i={};return c.integrity&&(i.integrity=c.integrity),c.referrerPolicy&&(i.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?i.credentials="include":c.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(c){if(c.ep)return;c.ep=!0;const i=a(c);fetch(c.href,i)}})();const hs=({role:s,currentRole:r,onClick:a,icon:t})=>{const c=i=>{switch(i){case f.Doctor:return"طبيب";case f.Nurse:return"ممرض";case f.PhysicalTherapist:return"علاج طبيعي";case f.SocialWorker:return"اجتماعي";case f.Driver:return"سائق";default:return i}};return e.jsxs("button",{onClick:()=>a(s),className:`flex flex-col items-center gap-1 px-2 md:px-3 py-2 text-xs rounded-xl font-bold transition-all duration-300 touch-target-44 transform active:scale-95 min-w-[60px] ${r===s?"bg-white text-blue-700 shadow-xl scale-110 ring-2 ring-blue-300 border-2 border-blue-200":"bg-white/20 text-white hover:bg-white/30 backdrop-blur-sm hover:scale-105 hover:shadow-lg border border-white/30"}`,title:`تبديل إلى دور ${c(s)}`,children:[e.jsx("span",{className:"flex-shrink-0",children:t}),e.jsx("span",{className:"text-[10px] leading-tight text-center",children:c(s)})]})},us=({activeView:s,setActiveView:r})=>{const a=[{id:"patients",label:"Patients",icon:e.jsx(de,{size:16})},{id:"visits",label:"Today's Visits",icon:e.jsx(ze,{size:16})},{id:"settings",label:"Settings",icon:e.jsx(xe,{size:16})}];return e.jsx("div",{className:"flex items-center bg-white/95 backdrop-blur-md rounded-xl p-1 shadow-xl border border-white/30",children:a.map(t=>e.jsxs("button",{onClick:()=>r(t.id),className:`flex items-center gap-1.5 px-2 md:px-4 py-2 text-xs md:text-sm rounded-lg font-medium transition-all duration-300 touch-target-44 transform active:scale-95 ${s===t.id?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg scale-105":"text-blue-700 hover:bg-blue-50 hover:scale-102"}`,children:[t.icon,e.jsx("span",{className:"hidden md:inline",children:t.label})]},t.id))})},re=({activeView:s,setActiveView:r})=>{const{state:a,dispatch:t}=C(),c=n=>{t({type:"SET_ROLE",payload:n})},i=[{role:f.Doctor,icon:e.jsx(V,{size:16})},{role:f.Nurse,icon:e.jsx(_,{size:16})},{role:f.PhysicalTherapist,icon:e.jsx(K,{size:16})},{role:f.SocialWorker,icon:e.jsx(Z,{size:16})},{role:f.Driver,icon:e.jsx(Ie,{size:16})}];return e.jsxs("header",{className:"mobile-nav bg-gradient-to-r from-blue-700 to-blue-600 border-b border-blue-800 safe-area-inset-top flex flex-col lg:flex-row items-center justify-between gap-3 md:gap-4 sticky top-0 z-50 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3 w-full lg:w-auto justify-center lg:justify-start px-3 md:px-4 py-2",children:[e.jsxs("div",{className:"w-10 h-10 md:w-12 md:h-12 bg-white rounded-full flex items-center justify-center shadow-md p-1 flex-shrink-0",children:[e.jsx("img",{src:"/logo.png",alt:"Aseer Health Cluster Logo",className:"w-full h-full object-contain",onError:n=>{n.currentTarget.style.display="none",n.currentTarget.nextElementSibling.style.display="flex"}}),e.jsx("div",{className:"w-full h-full bg-blue-600 rounded-full items-center justify-center hidden",children:e.jsx("span",{className:"text-white font-bold text-sm md:text-base",children:"AHC"})})]}),e.jsxs("div",{className:"text-center lg:text-left",children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold text-white leading-tight",children:"Home Healthcare Department"}),e.jsx("p",{className:"text-xs md:text-sm text-blue-100 font-medium",children:"تجمع عسير الصحي – مستشفى الملك عبدالله ببيشة"}),e.jsx("p",{className:"text-xs text-blue-200",children:"الرعاية الصحية المنزلية"})]})]}),e.jsx("div",{className:"flex-grow flex items-center justify-center w-full lg:w-auto order-3 lg:order-2",children:a.currentRole!==f.Driver&&e.jsx(us,{activeView:s,setActiveView:r})}),e.jsx("div",{className:"flex items-center gap-1.5 p-1.5 bg-white/10 rounded-xl overflow-x-auto w-full lg:w-auto justify-center lg:justify-end order-2 lg:order-3 backdrop-blur-md border border-white/20",children:i.map(n=>e.jsx(hs,{role:n.role,currentRole:a.currentRole,onClick:c,icon:n.icon},n.role))})]})},q=({label:s,isActive:r,onClick:a})=>e.jsx("button",{onClick:a,className:`px-3 md:px-4 py-2 text-xs md:text-sm rounded-xl border-2 transition-all duration-200 flex-shrink-0 font-semibold touch-target-44 ${r?"bg-blue-600 text-white border-blue-600 shadow-lg scale-105":"bg-white text-gray-700 border-gray-200 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 shadow-sm"}`,children:s}),gs=()=>{const{state:s,dispatch:r}=C(),[a,t]=m.useState("team1"),c=s.selectedPatientIds.size>0,i=()=>{if(s.selectedPatientIds.size>0){const n=new Date().toISOString().split("T")[0];r({type:"ASSIGN_TO_VISITS",payload:{patientIds:Array.from(s.selectedPatientIds),date:n,teamId:a}})}};return c?e.jsx("div",{className:"p-3 md:p-4 border-t border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-3 shadow-sm border border-blue-200",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx(me,{size:16}),s.selectedPatientIds.size," مريض محدد"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-2 block",children:"اختيار الفريق"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:s.teams.map(n=>e.jsx("button",{onClick:()=>t(n.id),className:`px-4 py-3 text-sm font-medium rounded-lg border-2 transition-all duration-200 touch-target-44 ${a===n.id?"bg-blue-600 text-white border-blue-600 shadow-lg scale-[1.02]":"bg-white text-gray-700 border-gray-200 hover:border-blue-400 hover:bg-blue-50"}`,children:n.name},n.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:i,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold py-3 px-4 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 flex items-center justify-center gap-2 shadow-md touch-target-44",children:[e.jsx(Re,{size:18}),"إضافة لزيارات اليوم"]}),e.jsx("button",{onClick:()=>r({type:"CLEAR_SELECTIONS"}),className:"w-full text-center py-2 text-sm text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:"إلغاء التحديد"})]})]})}):null},ae=()=>{const{state:s,dispatch:r,filteredPatients:a}=C(),{filters:t,areas:c,selectedPatientIds:i}=s,n=m.useMemo(()=>{const o=new Set;return s.patients&&Array.isArray(s.patients)&&s.patients.forEach(l=>{l.tags&&Array.isArray(l.tags)&&l.tags.forEach(j=>o.add(j))}),Array.from(o)},[s.patients]),d=()=>{if(a&&Array.isArray(a)){const o=a.map(l=>l.nationalId);r({type:"SELECT_ALL_FILTERED",payload:o})}};return e.jsxs("aside",{className:"w-full lg:w-80 bg-white border-r border-gray-200 flex flex-col flex-shrink-0 h-full overflow-y-hidden",children:[e.jsxs("div",{className:"p-3 md:p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-blue-500",size:18}),e.jsx("input",{type:"text",placeholder:"Smart search: name, ID, area, diagnosis...",value:t.search,onChange:o=>r({type:"SET_SEARCH",payload:o.target.value}),className:"w-full bg-white border-2 border-blue-200 rounded-xl pl-11 pr-4 py-3 text-sm md:text-base font-medium focus:outline-none focus:ring-4 focus:ring-blue-300 focus:border-blue-500 shadow-sm placeholder-gray-500 touch-target-44"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-xs md:text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[e.jsx("input",{type:"checkbox",id:"select-all",className:"h-5 w-5 md:h-6 md:w-6 rounded-md border-2 border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2 touch-target-44",onChange:o=>o.target.checked?d():r({type:"CLEAR_SELECTIONS"}),checked:a.length>0&&i.size===a.length}),e.jsxs("label",{htmlFor:"select-all",className:"text-gray-700 font-medium",children:[e.jsx("span",{className:"text-blue-600 font-bold",children:a.length})," Results",i.size>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",i.size," selected)"]})]})]}),e.jsxs("button",{onClick:()=>r({type:"CLEAR_FILTERS"}),className:"flex items-center gap-1 text-red-500 hover:text-red-700 font-medium px-2 py-1 rounded-lg hover:bg-red-50 transition-colors touch-target-44",children:[e.jsx(O,{size:14})," Clear"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-3 md:p-4 space-y-4 md:space-y-5",children:[e.jsx(G,{icon:e.jsx(L,{size:16}),title:"Areas",children:(c||[]).map(o=>e.jsx(q,{label:o,isActive:t.areas.includes(o),onClick:()=>r({type:"TOGGLE_AREA_FILTER",payload:o})},o))}),e.jsx(G,{icon:e.jsx(De,{size:16}),title:"Tags",children:n.map(o=>e.jsx(q,{label:o,isActive:t.tags.includes(o),onClick:()=>r({type:"TOGGLE_TAG_FILTER",payload:o})},o))}),e.jsx(G,{icon:e.jsx(Me,{size:16}),title:"Last Visit Risk",children:["green","yellow","red"].map(o=>e.jsx(q,{label:o.charAt(0).toUpperCase()+o.slice(1),isActive:t.risk.includes(o),onClick:()=>r({type:"TOGGLE_RISK_FILTER",payload:o})},o))})]})}),e.jsx(gs,{})]})},G=({icon:s,title:r,children:a})=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-3 md:p-4 shadow-sm",children:[e.jsxs("h3",{className:"text-sm md:text-base font-bold text-gray-800 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:s})," ",r]}),e.jsx("div",{className:"flex flex-wrap gap-2 md:gap-3",children:a})]}),Ce=({title:s,titleAr:r,patient:a,role:t,subtitle:c,showIcons:i=!0})=>{const n=d=>{switch(d){case f.Doctor:return"from-blue-600 to-blue-700";case f.Nurse:return"from-green-600 to-green-700";case f.PhysicalTherapist:return"from-purple-600 to-purple-700";case f.SocialWorker:return"from-orange-600 to-orange-700";default:return"from-blue-600 to-blue-700"}};return e.jsxs("div",{className:`bg-gradient-to-r ${n(t)} text-white p-4 md:p-6 rounded-t-lg`,children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 md:gap-4",children:[i&&e.jsxs("div",{className:"flex flex-col gap-2 flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 bg-white rounded-lg flex items-center justify-center shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-green-600 font-bold text-lg md:text-xl",children:"🇸🇦"}),e.jsx("div",{className:"text-xs text-green-600 font-bold",children:"MOH"})]})}),e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 bg-white rounded-lg flex items-center justify-center shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-blue-600 font-bold text-sm",children:"KAH"}),e.jsx("div",{className:"text-xs text-blue-600",children:"Bisha"})]})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h1",{className:"text-lg md:text-2xl font-bold leading-tight",children:s}),e.jsx("p",{className:"text-sm md:text-lg text-blue-100 opacity-90",children:r})]}),c&&e.jsx("p",{className:"text-xs md:text-sm text-blue-200",children:c}),e.jsxs("div",{className:"text-xs md:text-sm text-blue-200 mt-1",children:[e.jsx("p",{children:"King Abdullah Hospital - Bisha | مستشفى الملك عبدالله - بيشه"}),e.jsx("p",{className:"opacity-75",children:"Home Healthcare Division | قسم الرعاية الصحية المنزلية"})]})]})]}),e.jsxs("div",{className:"flex-shrink-0",children:[a&&e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 md:p-4 text-right",children:[e.jsx("p",{className:"text-xs md:text-sm text-blue-100 mb-1",children:"Patient | المريض"}),e.jsx("p",{className:"font-bold text-sm md:text-lg mb-1",children:a.nameAr}),e.jsxs("p",{className:"text-xs text-blue-200",children:["ID: ",a.nationalId]}),a.areaId&&e.jsxs("p",{className:"text-xs text-blue-200",children:["Area: ",a.areaId]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 mt-2 text-right text-xs md:text-sm",children:[e.jsx("p",{className:"text-blue-100 mb-1",children:"Date | التاريخ"}),e.jsx("p",{className:"font-bold",children:new Date().toLocaleDateString()}),e.jsx("p",{className:"text-blue-200",children:new Date().toLocaleDateString("ar-SA")}),t&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-white/20",children:[e.jsx("p",{className:"text-blue-100",children:"Role | الدور"}),e.jsx("p",{className:"font-semibold",children:t})]})]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-2 text-xs text-blue-200",children:[e.jsx("p",{children:"Aseer Health Cluster | تجمع عسير الصحي"}),e.jsxs("p",{children:["Document ID: DOC-",Date.now().toString().slice(-6)]})]})})]})},bs=({patient:s,role:r,assessmentType:a,visitDate:t,onClose:c,onSave:i})=>{const{state:n}=C(),d=Je(),[o,l]=m.useState(null),[j,b]=m.useState(!1),[u,g]=m.useState(!1),[p,x]=m.useState(null),[y,v]=m.useState(null);m.useEffect(()=>{(()=>{if(t){const h=d.getDraftVisitNote(s.nationalId,t,r);h&&(l(h.formData),v(new Date(h.lastSaved)),console.log("📄 Loaded draft visit note:",h))}else{const h=d.getDraftAssessment(s.nationalId,r);h&&(l(h.formData),v(new Date(h.lastSaved)),console.log("📄 Loaded draft assessment:",h))}})()},[s.nationalId,r,t,d]);const k=m.useCallback(async N=>{if(!(!d.getAutoSaveEnabled()||!j))try{x("saving"),t?d.saveDraftVisitNote(s.nationalId,t,r,N,!1):d.saveDraftAssessment(s.nationalId,r,N,!1),v(new Date),x("saved"),setTimeout(()=>x(null),2e3)}catch(h){console.error("Auto-save error:",h),x("error")}},[s.nationalId,r,t,j,d]);m.useEffect(()=>{if(!j||!o)return;const N=setTimeout(()=>{k(o)},3e3);return()=>clearTimeout(N)},[o,j,k]);const I=m.useCallback(N=>{l(N),b(!0)},[]),w=async N=>{try{if(g(!0),t)i(N),d.deleteDraftVisitNote(s.nationalId,t,r);else{const h={id:Date.now().toString(),date:new Date().toISOString(),role:r,assessorName:"Current User",assessorId:"user-id",...N};i(h),d.deleteDraftAssessment(s.nationalId,r)}c()}catch(h){console.error("Save error:",h)}finally{g(!1)}},S=()=>{if(j){if(!window.confirm("You have unsaved changes. They will be saved as a draft. Do you want to continue?"))return;o&&(t?d.saveDraftVisitNote(s.nationalId,t,r,o,!1):d.saveDraftAssessment(s.nationalId,r,o,!1))}c()},A=()=>{const N={initialData:o,onSave:w,onCancel:S,onChange:I,patient:s};if(a==="initial")switch(r){case f.Doctor:return e.jsx(rs,{...N});case f.Nurse:return e.jsx(ts,{...N});case f.PhysicalTherapist:return e.jsx(ss,{...N});case f.SocialWorker:return e.jsx(es,{...N});default:return null}else switch(r){case f.Doctor:return e.jsx(Se,{...N});case f.Nurse:return e.jsx(we,{...N});case f.PhysicalTherapist:return e.jsx(ve,{...N});case f.SocialWorker:return e.jsx(Ne,{...N});default:return null}},D=()=>{const N=a==="initial"?"Initial Assessment":"Follow-up Assessment";return t?`Visit Note - ${N}`:N},B=()=>{const N=a==="initial"?"التقييم الأولي":"تقييم المتابعة";return t?`ملاحظة الزيارة - ${N}`:N},F=()=>{let N=`${r} - ${a==="initial"?"التقييم الأولي":"تقييم المتابعة"}`;return t&&(N+=` - زيارة ${new Date(t).toLocaleDateString("ar-SA")}`),N},W=()=>d.getAutoSaveEnabled()?e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[p==="saving"&&e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx(T,{size:12,className:"animate-spin"}),e.jsx("span",{children:"Saving..."})]}),p==="saved"&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(he,{size:12}),e.jsx("span",{children:"Auto-saved"})]}),p==="error"&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx($,{size:12}),e.jsx("span",{children:"Save failed"})]}),y&&!p&&e.jsxs("div",{className:"text-gray-500",children:["Last saved: ",y.toLocaleTimeString()]})]}):null;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col border-2 border-blue-500 ring-4 ring-blue-200/50 mx-auto my-auto",children:[e.jsx(Ce,{title:D(),titleAr:B(),patient:s,role:r,subtitle:F()}),e.jsx("div",{className:"px-4 md:px-6 py-2 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(W,{}),j&&e.jsxs("div",{className:"flex items-center gap-1 text-orange-600 text-xs",children:[e.jsx($,{size:12}),e.jsx("span",{children:"Unsaved changes"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:S,className:"text-xs px-3 py-1 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all",children:"Cancel"}),e.jsx("button",{onClick:()=>w(o),disabled:u||!o,className:"text-xs px-4 py-1 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 transition-all",children:u?e.jsxs(e.Fragment,{children:[e.jsx(T,{size:12,className:"animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{size:12}),"Save & Complete"]})})]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:A()})]})})},ps=({patient:s,onClose:r})=>{const{state:a,dispatch:t}=C(),[c,i]=m.useState("assessment"),[n,d]=m.useState(null),o=a.staff.find(b=>b.المهنة==="أخصائي اجتماعي")||{الاسم:"أخصائي اجتماعي",المهنة:"أخصائي اجتماعي",الايميل:"",الجوال:"",رقم_الهوية:""},l=b=>{t({type:"SAVE_ASSESSMENT",payload:{patientId:s.nationalId,assessment:b}}),d({patient:s,assessor:o,formData:b}),i("report")},j=()=>{i("assessment"),r()};return e.jsxs(e.Fragment,{children:[c==="assessment"&&e.jsx(as,{patient:s,onSave:l,onCancel:r}),c==="report"&&n&&e.jsx(ls,{data:n,onClose:j})]})},fs=({patient:s,onClose:r})=>{const{state:a}=C(),[t,c]=m.useState({selectedRole:null,assessmentType:null,showAssessmentModal:!1}),i=a.currentRole,n=[{role:f.Doctor,title:"Doctor Assessment",titleAr:"تقييم طبي أولي/متابعة",icon:V,color:"blue",description:"تقييم طبي شامل - تشخيص وخطة علاج"},{role:f.Nurse,title:"Nursing Assessment",titleAr:"تقييم تمريضي أولي/متابعة",icon:_,color:"green",description:"فحص العلامات الحيوية والجروح والأدوية"},{role:f.PhysicalTherapist,title:"Physical Therapy",titleAr:"تقييم علاج طبيعي",icon:K,color:"purple",description:"تقييم الحركة والقوة وإعادة التأهيل"},{role:f.SocialWorker,title:"Social Work Assessment",titleAr:"تقييم اجتماعي ذكي",icon:Z,color:"orange",description:"تقييم اجتماعي شامل مع تقرير ذكي"}],d=m.useMemo(()=>s.assessments?s.assessments.reduce((x,y)=>(x[y.role]||(x[y.role]=[]),x[y.role].push(y),x),{}):{},[s.assessments]),o=m.useCallback(x=>d[x]||[],[d]),l=m.useCallback(x=>{const y=o(x);return y.length>0?y[0]:null},[o]),j=m.useCallback(x=>{const y=o(x);c(v=>({...v,selectedRole:x,assessmentType:y.length===0?"initial":null}))},[o]),b=m.useCallback(x=>{c(y=>({...y,assessmentType:x,showAssessmentModal:!0}))},[]),u=m.useCallback(x=>{c({selectedRole:null,assessmentType:null,showAssessmentModal:!1}),r()},[r]),g=x=>{const y=o(x.role),v=l(x.role),k=i===x.role||i===f.Coordinator,I=x.icon,w=v?Math.floor((Date.now()-new Date(v.date).getTime())/(1e3*60*60*24)):null;return e.jsx("button",{onClick:()=>k&&j(x.role),disabled:!k,className:`w-full text-left p-4 rounded-lg border-2 transition-all transform hover:scale-[1.02] active:scale-[0.98] ${t.selectedRole===x.role?`border-${x.color}-500 bg-${x.color}-50 shadow-lg`:k?`border-gray-200 hover:border-${x.color}-300 bg-white hover:shadow-md`:"border-gray-100 bg-gray-50 opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center transition-all ${t.selectedRole===x.role?`bg-${x.color}-500 text-white`:`bg-${x.color}-100 text-${x.color}-600`}`,children:e.jsx(I,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900",children:x.title}),e.jsx("p",{className:"text-sm text-gray-600",children:x.titleAr})]}),e.jsx("div",{className:"flex items-center gap-2",children:y.length>0?e.jsxs("span",{className:`px-2 py-1 bg-${x.color}-100 text-${x.color}-700 text-xs rounded-full flex items-center gap-1`,children:[e.jsx(he,{size:12}),y.length," assessment",y.length>1?"s":""]}):e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full flex items-center gap-1",children:[e.jsx(T,{size:12}),"No assessments"]})})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:x.description}),v&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Last assessment:"}),e.jsx("span",{className:"font-medium",children:new Date(v.date).toLocaleDateString("ar-SA")})]}),w!==null&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"Days ago:"}),e.jsxs("span",{className:`font-medium ${w>30?"text-red-600":w>14?"text-yellow-600":"text-green-600"}`,children:[w," days"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:"font-medium",children:v.status})]})]}),!k&&e.jsxs("div",{className:"mt-2 text-xs text-red-600 flex items-center gap-1",children:[e.jsx($,{size:12}),"Only ",x.role," can perform this assessment"]})]})]})},x.role)},p=()=>{if(!t.selectedRole||t.assessmentType!==null)return null;const x=o(t.selectedRole),y=n.find(v=>v.role===t.selectedRole);return e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(z,{size:16}),"Select Assessment Type | اختر نوع التقييم"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>b("initial"),className:`p-4 rounded-lg border-2 transition-all text-left ${x.length===0?`border-${y.color}-500 bg-${y.color}-50`:"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${x.length===0?`bg-${y.color}-500 text-white`:"bg-gray-100 text-gray-600"}`,children:e.jsx(P,{size:16})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Initial Assessment"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"التقييم الأولي"}),e.jsx("p",{className:"text-xs text-gray-500",children:x.length===0?"Recommended: No previous assessments found":"Create new initial baseline assessment"})]})]})}),e.jsx("button",{onClick:()=>b("followup"),disabled:x.length===0,className:`p-4 rounded-lg border-2 transition-all text-left ${x.length>0?`border-${y.color}-500 bg-${y.color}-50 hover:bg-${y.color}-100`:"border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${x.length>0?`bg-${y.color}-500 text-white`:"bg-gray-100 text-gray-400"}`,children:e.jsx(U,{size:16})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Follow-up Assessment"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"تقييم المتابعة"}),e.jsx("p",{className:"text-xs text-gray-500",children:x.length>0?`Based on ${x.length} previous assessment${x.length>1?"s":""}`:"Requires initial assessment first"})]})]})})]})]})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col mx-auto my-auto",children:[e.jsx(Ce,{title:"Smart Assessment Selector",titleAr:"محدد التقييم الذكي",patient:s,subtitle:"Choose the appropriate assessment type for optimal care documentation",showIcons:!0}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 mb-6 border border-blue-200",children:[e.jsx("h3",{className:"font-bold text-blue-800 mb-3",children:"Patient Assessment Overview"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:n.map(x=>{const y=o(x.role).length,v=l(x.role);return e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(x.icon,{size:14,className:`text-${x.color}-600`}),e.jsx("span",{className:"font-medium text-gray-900",children:x.role})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[e.jsxs("div",{children:[y," assessment",y!==1?"s":""]}),v&&e.jsxs("div",{className:"text-blue-600",children:["Last: ",new Date(v.date).toLocaleDateString()]})]})]},x.role)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg mb-4",children:"Select Healthcare Role | اختر التخصص الطبي"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(g)})]}),p()]}),e.jsx("div",{className:"border-t border-gray-200 p-6 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Current Role: ",e.jsx("span",{className:"font-medium",children:i})]}),e.jsx("button",{onClick:r,className:"px-6 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all",children:"Cancel | إلغاء"})]})})]})}),t.showAssessmentModal&&t.selectedRole&&t.assessmentType&&e.jsx(e.Fragment,{children:t.selectedRole===f.SocialWorker?e.jsx(ps,{patient:s,onClose:()=>{c(x=>({...x,showAssessmentModal:!1,selectedRole:null,assessmentType:null})),r()}}):e.jsx(bs,{patient:s,role:t.selectedRole,assessmentType:t.assessmentType,onClose:()=>{c(x=>({...x,showAssessmentModal:!1,selectedRole:null,assessmentType:null}))},onSave:u})})]})},js=({patient:s,onClose:r})=>{const[a,t]=m.useState([]),[c,i]=m.useState("all");m.useEffect(()=>{(()=>{const j=localStorage.getItem(`patient_history_${s.nationalId}`);if(j)t(JSON.parse(j));else{const b=[{id:"1",patientId:s.nationalId,date:"2024-01-15",role:"Nurse",type:"Assessment",data:{vitals:{bp:"120/80",hr:"72"},notes:"تقييم ممرض - حالة مستقرة"},createdBy:"ممرض أحمد محمد"},{id:"2",patientId:s.nationalId,date:"2024-01-10",role:"Doctor",type:"Assessment",data:{diagnosis:"متابعة روتينية",plan:"استمرار العلاج"},createdBy:"د. فاطمة السعد"},{id:"3",patientId:s.nationalId,date:"2024-01-08",role:"System",type:"Card",data:{printed:!0},createdBy:"النظام"}];t(b),localStorage.setItem(`patient_history_${s.nationalId}`,JSON.stringify(b))}})()},[s.nationalId]);const n=c==="all"?a:a.filter(l=>l.type===c),d=l=>{switch(l){case"Assessment":return e.jsx(H,{size:16,className:"text-blue-600"});case"Card":return e.jsx(J,{size:16,className:"text-green-600"});case"Report":return e.jsx(X,{size:16,className:"text-purple-600"});default:return e.jsx(H,{size:16,className:"text-gray-600"})}},o=l=>{switch(l){case"Assessment":return"bg-blue-50 border-blue-200 text-blue-800";case"Card":return"bg-green-50 border-green-200 text-green-800";case"Report":return"bg-purple-50 border-purple-200 text-purple-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"سجل المريض"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.nameAr," - ",s.nationalId]})]}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"إغلاق"})]})}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:["all","Assessment","Card","Report"].map(l=>e.jsxs("button",{onClick:()=>i(l),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===l?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[l==="all"?"الكل":l==="Assessment"?"التقييمات":l==="Card"?"البطاقات":"التقارير",e.jsx("span",{className:"mr-2 bg-white bg-opacity-20 px-2 py-0.5 rounded-full text-xs",children:l==="all"?a.length:a.filter(j=>j.type===l).length})]},l))})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(H,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"لا توجد سجلات متاحة"})]}):e.jsx("div",{className:"space-y-3",children:n.map(l=>e.jsx("div",{className:`border rounded-lg p-4 ${o(l.type)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[d(l.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-bold text-sm",children:l.type==="Assessment"?"تقييم طبي":l.type==="Card"?"بطاقة مريض":"تقرير"}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-white bg-opacity-50 rounded-full",children:l.role})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{size:12}),new Date(l.date).toLocaleDateString("ar-SA")]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{size:12}),l.createdBy]})]}),e.jsxs("div",{className:"text-xs bg-white bg-opacity-30 rounded p-2",children:[l.type==="Assessment"&&l.data.notes&&e.jsx("p",{className:"truncate",children:l.data.notes}),l.type==="Assessment"&&l.data.vitals&&e.jsxs("p",{children:["العلامات الحيوية: ",Object.entries(l.data.vitals).map(([j,b])=>`${j}: ${b}`).join(", ")]}),l.type==="Card"&&e.jsx("p",{children:"تم إنشاء وطباعة بطاقة المريض"})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{title:"عرض التفاصيل",className:"p-2 rounded hover:bg-white hover:bg-opacity-30 transition-colors",children:e.jsx($e,{size:14})}),e.jsx("button",{title:"تحميل",className:"p-2 rounded hover:bg-white hover:bg-opacity-30 transition-colors",children:e.jsx(X,{size:14})})]})]})},l.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50 text-center text-xs text-gray-500",children:e.jsx("p",{children:"جميع السجلات محفوظة ومشفرة وفقاً لمعايير الأمان الطبي"})})]})})},le=[{value:"Phone Answered",label:"Phone Answered",labelAr:"تم الرد على الهاتف",icon:E,color:"green"},{value:"No Answer",label:"No Answer",labelAr:"لا يوجد رد",icon:Q,color:"yellow"},{value:"Door Not Opened",label:"Door Not Opened",labelAr:"لم يتم فتح الباب",icon:ue,color:"orange"},{value:"Family Answered",label:"Family Answered",labelAr:"رد أحد أفراد الأسرة",icon:E,color:"blue"},{value:"Busy",label:"Line Busy",labelAr:"الخط مشغول",icon:E,color:"red"},{value:"Phone Off",label:"Phone Turned Off",labelAr:"الهاتف مغلق",icon:Q,color:"gray"},{value:"Wrong Number",label:"Wrong Number",labelAr:"رقم خاطئ",icon:$,color:"red"},{value:"Patient Not Available",label:"Patient Not Available",labelAr:"المريض غير متاح",icon:T,color:"yellow"},{value:"Rescheduled",label:"Rescheduled",labelAr:"تم إعادة الجدولة",icon:z,color:"blue"},{value:"Refused Visit",label:"Refused Visit",labelAr:"رفض الزيارة",icon:O,color:"red"}],ne=[{value:"Phone Call",label:"Phone Call",labelAr:"مكالمة هاتفية",icon:E},{value:"Home Visit",label:"Home Visit",labelAr:"زيارة منزلية",icon:ue},{value:"WhatsApp",label:"WhatsApp",labelAr:"واتساب",icon:Y},{value:"SMS",label:"SMS",labelAr:"رسالة نصية",icon:Y}],oe=[{value:"Successful",label:"Successful",labelAr:"نجح",color:"green"},{value:"Failed",label:"Failed",labelAr:"فشل",color:"red"},{value:"Rescheduled",label:"Rescheduled",labelAr:"مُجدول مجدداً",color:"blue"},{value:"Cancelled",label:"Cancelled",labelAr:"ملغي",color:"gray"}],ys=({patientId:s,patientName:r,onClose:a})=>{const{state:t,dispatch:c}=C(),[i,n]=m.useState("Phone Answered"),[d,o]=m.useState("Phone Call"),[l,j]=m.useState("Successful"),[b,u]=m.useState(""),[g,p]=m.useState(""),[x,y]=m.useState(""),[v,k]=m.useState(""),[I,w]=m.useState(!1),S=t.staff.find(h=>h.الاسم.includes(""))||{الاسم:"System User"},A=async()=>{w(!0);const h={date:new Date().toISOString(),type:i,staffName:S.الاسم,notes:b.trim()||void 0,callDuration:typeof g=="number"?g:void 0,nextAttemptScheduled:x&&v?new Date(`${x}T${v}`).toISOString():void 0,outcome:l,contactMethod:d};c({type:"LOG_CONTACT_ATTEMPT",payload:{patientId:s,contactAttempt:h}}),await new Promise(M=>setTimeout(M,500)),w(!1),a()},D=le.find(h=>h.value===i),B=ne.find(h=>h.value===d),F=oe.find(h=>h.value===l),W=d==="Phone Call"&&i==="Phone Answered",N=l==="Rescheduled"||i==="No Answer"||i==="Busy";return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[95vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(E,{className:"text-orange-600",size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Contact Attempt"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["محاولة التواصل - ",r]})]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(O,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Contact Method | طريقة التواصل"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:ne.map(h=>{const M=h.icon;return e.jsx("button",{onClick:()=>o(h.value),className:`p-4 rounded-lg border-2 transition-all ${d===h.value?"border-orange-500 bg-orange-50":"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${d===h.value?"bg-orange-500 text-white":"bg-orange-100 text-orange-600"}`,children:e.jsx(M,{size:16})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:h.label}),e.jsx("p",{className:"text-sm text-gray-600",children:h.labelAr})]})]})},h.value)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Contact Result | نتيجة التواصل"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:le.map(h=>{const M=h.icon;return e.jsx("button",{onClick:()=>n(h.value),className:`p-3 rounded-lg border-2 transition-all ${i===h.value?`border-${h.color}-500 bg-${h.color}-50`:"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded flex items-center justify-center ${i===h.value?`bg-${h.color}-500 text-white`:`bg-${h.color}-100 text-${h.color}-600`}`,children:e.jsx(M,{size:14})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:h.label}),e.jsx("p",{className:"text-xs text-gray-600",children:h.labelAr})]})]})},h.value)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Overall Outcome | النتيجة العامة"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:oe.map(h=>e.jsx("button",{onClick:()=>j(h.value),className:`p-3 rounded-lg border-2 transition-all ${l===h.value?`border-${h.color}-500 bg-${h.color}-50`:"border-gray-200 hover:border-gray-300 bg-white"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mx-auto mb-1 ${l===h.value?`bg-${h.color}-500`:`bg-${h.color}-300`}`}),e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:h.label}),e.jsx("p",{className:"text-xs text-gray-600",children:h.labelAr})]})},h.value))})]}),W&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Call Duration (minutes) | مدة المكالمة (دقائق)"}),e.jsx("input",{type:"number",min:"0",max:"120",value:g,onChange:h=>p(h.target.value?parseInt(h.target.value):""),placeholder:"5",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),N&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Schedule Next Attempt | جدولة المحاولة التالية"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date | التاريخ"}),e.jsx("input",{type:"date",value:x,onChange:h=>y(h.target.value),min:new Date().toISOString().split("T")[0],className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Time | الوقت"}),e.jsx("input",{type:"time",value:v,onChange:h=>k(h.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes | ملاحظات إضافية"}),e.jsx("textarea",{value:b,onChange:h=>u(h.target.value),rows:4,placeholder:"Add any additional details about the contact attempt...",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Summary | الملخص"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Method:"}),e.jsx("span",{className:"font-medium",children:B?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Result:"}),e.jsx("span",{className:"font-medium",children:D?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Outcome:"}),e.jsx("span",{className:`font-medium text-${F?.color}-600`,children:F?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Staff:"}),e.jsx("span",{className:"font-medium",children:S.الاسم})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:a,className:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-orange-500 transition-all",children:"Cancel | إلغاء"}),e.jsx("button",{onClick:A,disabled:I,className:"px-6 py-2 text-sm font-medium text-white bg-orange-600 border border-transparent rounded-lg hover:bg-orange-700 focus:ring-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-all",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{size:16}),"Save Contact Attempt | حفظ"]})})]})]})})},Ns=({label:s})=>{const r={Catheter:"bg-blue-500 text-white shadow-sm","Pressure Ulcer":"bg-red-500 text-white shadow-sm","Tube Feeding":"bg-amber-500 text-white shadow-sm","Fall Risk":"bg-purple-500 text-white shadow-sm","IV Therapy":"bg-indigo-500 text-white shadow-sm",Ventilation:"bg-pink-500 text-white shadow-sm"};return e.jsx("span",{className:`px-2.5 py-1 text-xs font-bold rounded-full border-2 border-white/50 ${r[s]||"bg-gray-500 text-white shadow-sm"}`,children:s})},Ae=m.memo(({patient:s})=>{const{state:r,dispatch:a}=C(),[t,c]=m.useState({showSmartAssessmentSelector:!1,generatingPdf:!1,showPrintCard:!1,showHistory:!1,showPrintManager:!1,showEnhancedPrintManager:!1,showEnhancedContactManager:!1,selectedAssessmentForPrint:null}),i=r.selectedPatientIds.has(s.nationalId),n=Qe(s.admissionDate);s.assessments?.[0];const d=m.useCallback(()=>{a({type:"TOGGLE_PATIENT_SELECTION",payload:s.nationalId})},[a,s.nationalId]);m.useCallback(l=>{const b=(r.staff||[]).find(g=>g.الاسم&&g.الاسم.length>0)||{الاسم:"System User"},u={date:new Date().toISOString(),type:l,staffName:b.الاسم,contactMethod:"Phone Call",outcome:"Successful"};a({type:"LOG_CONTACT_ATTEMPT",payload:{patientId:s.nationalId,contactAttempt:u}})},[r.staff,s.nationalId,a]);const o=[f.Doctor,f.Nurse,f.PhysicalTherapist,f.SocialWorker].includes(r.currentRole);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`mobile-card ${i?"border-blue-500 ring-4 ring-blue-200/50 shadow-blue-100 transform scale-[1.02]":"border-gray-100 hover:border-blue-200"} transition-all duration-300 flex flex-col hover:shadow-xl transform hover:scale-[1.01] gpu-accelerated`,children:[e.jsxs("div",{className:"p-4 md:p-5 flex-grow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>{if(s.gmapsUrl){const l=encodeURIComponent(`${s.nameAr} ${s.areaId||""}`);window.open(`https://maps.google.com/?q=${l}`,"_blank")}else alert("No location data available | لا توجد بيانات موقع")},className:"w-12 h-12 md:w-14 md:h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-lg border-2 border-white hover:shadow-xl transition-all transform hover:scale-110 active:scale-95 ripple",title:"Open Google Maps Location | فتح الموقع في خرائط جوجل",children:e.jsx(ge,{size:20,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-base md:text-lg leading-tight truncate",children:s.nameAr}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("p",{className:"text-xs md:text-sm text-gray-500",children:s.sex}),s.status==="active"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),"نشط"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:[s.contactAttempts&&s.contactAttempts.length>0&&e.jsxs("span",{className:"bg-orange-500 text-white text-xs font-bold px-2.5 py-1 rounded-full flex items-center gap-1 shadow-sm",title:`${s.contactAttempts.length} failed contact attempts`,children:[e.jsx(Q,{size:12}),s.contactAttempts.length]}),e.jsx("input",{type:"checkbox",checked:i,onChange:d,className:"h-5 w-5 md:h-6 md:w-6 rounded-md border-2 border-gray-300 text-blue-600 focus:ring-blue-500 focus:ring-2 cursor-pointer touch-target-44"})]})]}),e.jsxs("div",{className:"space-y-2.5 text-sm md:text-base text-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2.5",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-2.5",children:[e.jsx(be,{size:16,className:"text-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs text-gray-500 block",children:"رقم الهوية"}),e.jsx("span",{className:"font-medium truncate",children:s.nationalId})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-2.5",children:[e.jsx(E,{size:16,className:"text-green-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs text-gray-500 block",children:"الهاتف"}),e.jsx("span",{className:"font-medium truncate",children:s.phone||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-2.5",children:[e.jsx(L,{size:16,className:"text-purple-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs text-gray-500 block",children:"المنطقة"}),e.jsx("span",{className:"font-medium truncate",children:s.areaId||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-lg p-2.5",children:[e.jsx(z,{size:16,className:"text-amber-500 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-xs text-gray-500 block",children:"تاريخ القبول"}),e.jsx("span",{className:"font-medium truncate",children:s.admissionDate?new Date(s.admissionDate).toLocaleDateString("ar-SA"):"N/A"})]})]})]}),(s.bradenScore||s.level||s.minMonthlyRequired)&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-3 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-blue-800 mb-2 flex items-center gap-2",children:[e.jsx(U,{size:14,className:"text-blue-600"}),"معلومات طبية",e.jsx("span",{className:"text-xs font-normal text-blue-600",children:"Clinical Data"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[s.bradenScore&&e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg p-2 border border-blue-100",children:[e.jsx(pe,{size:14,className:"text-blue-500"}),e.jsxs("span",{children:["نقاط برادن: ",e.jsx("strong",{className:`${s.bradenScore<=12?"text-red-600":s.bradenScore<=14?"text-yellow-600":"text-green-600"}`,children:s.bradenScore})]})]}),s.level&&e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg p-2 border border-green-100",children:[e.jsx(Oe,{size:14,className:"text-green-500"}),e.jsxs("span",{children:["المستوى: ",e.jsx("strong",{children:s.level})]})]}),s.minMonthlyRequired&&e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg p-2 border border-purple-100",children:[e.jsx(z,{size:14,className:"text-purple-500"}),e.jsxs("span",{children:["الزيارات الشهرية: ",e.jsx("strong",{children:s.minMonthlyRequired})]})]}),s.lastVisit&&e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg p-2 border border-orange-100",children:[e.jsx(ee,{size:14,className:"text-orange-500"}),e.jsxs("span",{children:["آخر زيارة: ",e.jsx("strong",{children:new Date(s.lastVisit).toLocaleDateString("ar-SA")})]})]})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[(s.hasCatheter||s.wounds?.presentCount||s.ngTube||s.gTube||s.fallHighRisk||s.ivTherapy||s.ventSupport)&&e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 border border-red-200",children:[e.jsxs("h4",{className:"text-sm font-bold text-red-800 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-red-600 rounded-full"}),"الأجهزة والحالات الطبية"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.hasCatheter&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full border border-blue-200",children:"🩺 قسطرة"}),s.wounds&&s.wounds.presentCount&&s.wounds.presentCount>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded-full border border-red-200",children:["🩹 جروح (",s.wounds.presentCount,")"]}),s.ngTube&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full border border-green-200",children:"🔗 أنبوب أنفي"}),s.gTube&&e.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded-full border border-purple-200",children:"🔗 أنبوب معدي"}),s.fallHighRisk&&e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 text-xs font-medium rounded-full border border-orange-200",children:"⚠️ خطر السقوط"}),s.ivTherapy&&e.jsx("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 text-xs font-medium rounded-full border border-indigo-200",children:"💉 علاج وريدي"}),s.ventSupport&&e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full border border-yellow-200",children:"🫁 دعم تنفسي"})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(l=>e.jsx(Ns,{label:l},l))})]})]}),e.jsx("div",{className:"border-t-2 border-gray-100 bg-gradient-to-r from-gray-50 to-blue-50/30 px-4 md:px-5 py-3 md:py-4 rounded-b-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:`px-3 py-2 text-xs md:text-sm font-bold rounded-xl flex items-center gap-2 shadow-sm border ${Ke[n.level]}`,children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${n.level==="red"?"bg-red-500":n.level==="yellow"?"bg-yellow-500":"bg-green-500"}`}),n.label]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex items-center bg-white/50 rounded-lg p-1 border border-white/50",children:e.jsx("button",{onClick:()=>c(l=>({...l,showEnhancedContactManager:!0})),title:"سجل الاتصالات",className:"p-1.5 rounded-md hover:bg-blue-500 text-blue-600 hover:text-white transition-all transform hover:scale-110",children:e.jsx(E,{size:14})})}),e.jsxs("div",{className:"flex items-center bg-white/50 rounded-lg p-1 border border-white/50",children:[e.jsx("button",{onClick:()=>c(l=>({...l,showHistory:!0})),title:"سجل التقييمات",className:"p-1.5 rounded-md hover:bg-purple-500 text-purple-600 hover:text-white transition-all transform hover:scale-110",children:e.jsx(ee,{size:14})}),e.jsx("button",{onClick:()=>c(l=>({...l,showEnhancedPrintManager:!0})),title:"سجل الزيارات والطباعة",className:"p-1.5 rounded-md hover:bg-indigo-500 text-indigo-600 hover:text-white transition-all transform hover:scale-110",children:e.jsx(z,{size:14})})]}),o&&e.jsx("div",{className:"flex items-center bg-white/50 rounded-lg p-1 border border-white/50",children:e.jsx("button",{onClick:()=>c(l=>({...l,showSmartAssessmentSelector:!0})),title:"إضافة تقييم جديد",className:"p-1.5 rounded-md hover:bg-green-500 text-green-600 hover:text-white transition-all transform hover:scale-110",children:e.jsx(P,{size:14})})}),e.jsx("div",{className:"flex items-center bg-white/50 rounded-lg p-1 border border-white/50",children:e.jsx("button",{onClick:()=>c(l=>({...l,showEnhancedPrintManager:!0})),title:"طباعة التقارير",className:"p-1.5 rounded-md hover:bg-orange-500 text-orange-600 hover:text-white transition-all transform hover:scale-110",children:e.jsx(R,{size:14})})})]})]})})]}),t.showPrintCard&&e.jsx(ns,{patient:s,onClose:()=>c(l=>({...l,showPrintCard:!1}))}),t.showHistory&&e.jsx(js,{patient:s,onClose:()=>c(l=>({...l,showHistory:!1}))}),t.showPrintManager&&e.jsx(os,{patient:s,assessment:t.selectedAssessmentForPrint,staff:r.staff,onClose:()=>c(l=>({...l,showPrintManager:!1,selectedAssessmentForPrint:null}))}),t.showEnhancedPrintManager&&e.jsx(is,{patient:s,onClose:()=>c(l=>({...l,showEnhancedPrintManager:!1}))}),t.showEnhancedContactManager&&e.jsx(ys,{patientId:s.nationalId,patientName:s.nameAr,onClose:()=>c(l=>({...l,showEnhancedContactManager:!1}))}),t.showSmartAssessmentSelector&&e.jsx(fs,{patient:s,onClose:()=>c(l=>({...l,showSmartAssessmentSelector:!1}))})]})});Ae.displayName="PatientCard";const ie=({onClose:s})=>{const{state:r,dispatch:a}=C(),[t,c]=m.useState({nationalId:"",nameAr:"",phone:"",areaId:"",sex:"Male",bradenScore:"",level:"",minMonthlyRequired:"",admissionDate:new Date().toISOString().split("T")[0],hasCatheter:!1,ngTube:!1,gTube:!1,fallHighRisk:!1,ivTherapy:!1,ventSupport:!1}),[i,n]=m.useState({}),[d,o]=m.useState(!1),l=()=>{const u={};return t.nationalId.trim()?/^\d{10}$/.test(t.nationalId)?r.patients.some(g=>g.nationalId===t.nationalId)&&(u.nationalId="رقم الهوية موجود بالفعل"):u.nationalId="رقم الهوية يجب أن يكون 10 أرقام":u.nationalId="رقم الهوية مطلوب",t.nameAr.trim()||(u.nameAr="اسم المريض مطلوب"),t.phone&&!/^0\d{9}$/.test(t.phone)&&(u.phone="رقم الهاتف غير صحيح (يجب أن يبدأ بـ 0 و10 أرقام)"),t.bradenScore&&(isNaN(Number(t.bradenScore))||Number(t.bradenScore)<6||Number(t.bradenScore)>23)&&(u.bradenScore="نقاط برادن يجب أن تكون بين 6 و 23"),n(u),Object.keys(u).length===0},j=async u=>{if(u.preventDefault(),!!l()){o(!0);try{const g={nationalId:t.nationalId,nameAr:t.nameAr,phone:t.phone||null,areaId:t.areaId||null,status:"active",level:t.level||null,bradenScore:t.bradenScore?Number(t.bradenScore):null,minMonthlyRequired:t.minMonthlyRequired?Number(t.minMonthlyRequired):null,admissionDate:t.admissionDate,gmapsUrl:!1,sex:t.sex,hasCatheter:t.hasCatheter,ngTube:t.ngTube,gTube:t.gTube,fallHighRisk:t.fallHighRisk,ivTherapy:t.ivTherapy,ventSupport:t.ventSupport,tags:[],assessments:[],contactAttempts:[]},p=[...r.patients,g];a({type:"IMPORT_STATE",payload:{...r,patients:p,selectedPatientIds:new Set}}),s()}catch(g){console.error("Error adding patient:",g)}finally{o(!1)}}},b=(u,g)=>{c(p=>({...p,[u]:g})),i[u]&&n(p=>({...p,[u]:""}))};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(P,{className:"text-blue-600",size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"إضافة مريض جديد"}),e.jsx("p",{className:"text-sm text-gray-600",children:"أدخل بيانات المريض الأساسية"})]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(O,{size:20})})]})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(J,{size:18,className:"text-blue-600"}),"المعلومات الأساسية"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الهوية *"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",value:t.nationalId,onChange:u=>b("nationalId",u.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${i.nationalId?"border-red-500":"border-gray-300"}`,placeholder:"1234567890",maxLength:10})]}),i.nationalId&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.nationalId})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم المريض *"}),e.jsx("input",{type:"text",value:t.nameAr,onChange:u=>b("nameAr",u.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${i.nameAr?"border-red-500":"border-gray-300"}`,placeholder:"أدخل اسم المريض",dir:"rtl"}),i.nameAr&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.nameAr})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رقم الهاتف"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",value:t.phone,onChange:u=>b("phone",u.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${i.phone?"border-red-500":"border-gray-300"}`,placeholder:"0501234567",maxLength:10})]}),i.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المنطقة"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsxs("select",{value:t.areaId,onChange:u=>b("areaId",u.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"اختر المنطقة"}),r.areas.map(u=>e.jsx("option",{value:u,children:u},u))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الجنس"}),e.jsxs("select",{value:t.sex,onChange:u=>b("sex",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"Male",children:"ذكر"}),e.jsx("option",{value:"Female",children:"أنثى"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"تاريخ القبول"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"date",value:t.admissionDate,onChange:u=>b("admissionDate",u.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(pe,{size:18,className:"text-green-600"}),"المعلومات الطبية"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نقاط برادن"}),e.jsx("input",{type:"number",value:t.bradenScore,onChange:u=>b("bradenScore",u.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${i.bradenScore?"border-red-500":"border-gray-300"}`,placeholder:"6-23",min:"6",max:"23"}),i.bradenScore&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:i.bradenScore})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المستوى"}),e.jsx("input",{type:"text",value:t.level,onChange:u=>b("level",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1-4"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الزيارات الشهرية المطلوبة"}),e.jsx("input",{type:"number",value:t.minMonthlyRequired,onChange:u=>b("minMonthlyRequired",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1-4",min:"1",max:"10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"الأجهزة والحالات الطبية"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[{key:"hasCatheter",label:"قسطرة"},{key:"ngTube",label:"أنبوب أنفي"},{key:"gTube",label:"أنبوب معدي"},{key:"fallHighRisk",label:"خطر السقوط"},{key:"ivTherapy",label:"علاج وريدي"},{key:"ventSupport",label:"دعم تنفسي"}].map(u=>e.jsxs("label",{className:"flex items-center gap-2 p-2 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t[u.key],onChange:g=>b(u.key,g.target.checked),className:"text-blue-600 focus:ring-blue-500 rounded"}),e.jsx("span",{className:"text-sm",children:u.label})]},u.key))})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:d,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{size:16}),"إضافة المريض"]})})]})]})]})})},ke=m.memo(()=>{const{filteredPatients:s,state:r}=C(),[a,t]=m.useState(!1),[c,i]=m.useState(20),n=m.useMemo(()=>s.slice(0,c),[s,c]),d=s.length>c,o=()=>{i(l=>Math.min(l+20,s.length))};return s.length===0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"قائمة المرضى"}),e.jsx("span",{className:"bg-gray-100 text-gray-800 text-sm font-medium px-2.5 py-0.5 rounded-full",children:"0"})]}),e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg",children:[e.jsx(P,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"إضافة مريض"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 p-8 animate-fade-in",children:[e.jsx("div",{className:"bg-blue-50 rounded-full p-6 mb-6",children:e.jsx(Fe,{size:48,className:"text-blue-400"})}),e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-gray-800 mb-2",children:"لا توجد مرضى"}),e.jsx("p",{className:"text-center text-gray-600 max-w-md mb-4",children:r.patients.length===0?"لم يتم إضافة أي مرضى بعد. ابدأ بإضافة مريض جديد.":"جرب تعديل معايير البحث أو التصفية للعثور على المرضى."}),r.patients.length===0&&e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition-colors font-medium shadow-lg",children:[e.jsx(P,{size:20}),"إضافة أول مريض"]})]}),a&&e.jsx(ie,{onClose:()=>t(!1)})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"قائمة المرضى"}),e.jsx("span",{className:"bg-blue-100 text-blue-800 text-sm font-medium px-2.5 py-0.5 rounded-full",children:s.length})]}),e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg",children:[e.jsx(P,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"إضافة مريض"})]})]}),e.jsx("div",{className:"mobile-grid gap-4 md:gap-6 virtualized-list",children:n.map(l=>e.jsx("div",{className:"list-item",children:e.jsx(Ae,{patient:l})},l.nationalId))}),d&&e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{onClick:o,className:"bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg transition-colors font-medium",children:["عرض المزيد (",s.length-c," متبقي)"]})}),c>=s.length&&s.length>20&&e.jsxs("div",{className:"mt-4 text-center text-sm text-gray-500",children:["تم عرض جميع المرضى (",s.length,")"]}),a&&e.jsx(ie,{onClose:()=>t(!1)})]})});ke.displayName="PatientList";const vs=({visit:s})=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 text-sm md:text-base",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 border-2 border-blue-200",children:[e.jsxs("h4",{className:"font-bold text-blue-800 flex items-center gap-2 mb-3",children:[e.jsx(V,{size:16})," Doctor's Assessment"]}),s.doctorNote?e.jsxs("div",{className:"space-y-2 text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Status:"})," ",s.doctorNote.status]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Response:"})," ",s.doctorNote.responseToPlan]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Plan:"})," ",s.doctorNote.plan," ",s.doctorNote.planDetails?`(${s.doctorNote.planDetails.join(", ")})`:""]})]}),s.doctorNote.mdNote&&e.jsx("div",{className:"bg-white rounded-lg p-3 border-l-4 border-blue-500",children:e.jsxs("p",{className:"italic text-blue-700",children:['"',s.doctorNote.mdNote,'"']})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(T,{size:24,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"italic text-gray-500",children:"Pending Assessment"})]}),s.doctorSign&&e.jsx("div",{className:"mt-3 pt-2 border-t border-blue-200",children:e.jsxs("p",{className:"text-blue-600 text-sm font-medium",children:["✓ Signed by: ",s.doctorSign]})})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 border-2 border-green-200",children:[e.jsxs("h4",{className:"font-bold text-green-800 flex items-center gap-2 mb-3",children:[e.jsx(_,{size:16})," Nursing Care"]}),s.nurseNote?e.jsxs("div",{className:"space-y-2 text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Status:"})," ",s.nurseNote.status]})]}),s.nurseNote.vitals&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border-l-4 border-green-500",children:[e.jsx("p",{children:e.jsx("strong",{children:"Vitals:"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1 text-sm",children:[s.nurseNote.vitals.temp&&e.jsxs("span",{children:["T: ",s.nurseNote.vitals.temp,"°C"]}),s.nurseNote.vitals.o2sat&&e.jsxs("span",{children:["SpO₂: ",s.nurseNote.vitals.o2sat,"%"]}),s.nurseNote.vitals.bp&&e.jsxs("span",{children:["BP: ",s.nurseNote.vitals.bp]}),s.nurseNote.vitals.hr&&e.jsxs("span",{children:["HR: ",s.nurseNote.vitals.hr]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Tasks:"})," ",s.nurseNote.tasks.join(", ")]})]}),s.nurseNote.nurseNote&&e.jsx("div",{className:"bg-white rounded-lg p-3 border-l-4 border-green-500",children:e.jsxs("p",{className:"italic text-green-700",children:['"',s.nurseNote.nurseNote,'"']})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx(T,{size:24,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"italic text-gray-500",children:"Pending Assessment"})]}),s.nurseSign&&e.jsx("div",{className:"mt-3 pt-2 border-t border-green-200",children:e.jsxs("p",{className:"text-green-600 text-sm font-medium",children:["✓ Signed by: ",s.nurseSign]})})]}),s.ptNote&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-bold text-gray-600 flex items-center gap-1",children:[e.jsx(K,{size:14})," PT Note"]}),e.jsxs("div",{className:"pl-2 border-l-2 border-purple-200 space-y-1 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tolerance:"})," ",s.ptNote.tolerance]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Plan:"})," ",s.ptNote.plan]}),s.ptNote.ptNote&&e.jsxs("p",{className:"italic",children:['"',s.ptNote.ptNote,'"']})]}),s.ptSign&&e.jsxs("p",{className:"text-gray-400 text-[10px] pt-1",children:["Signed by: ",s.ptSign]})]}),s.swNote&&e.jsxs("div",{className:"space-y-2",dir:"rtl",children:[e.jsxs("h4",{className:"font-bold text-gray-600 flex items-center gap-1",children:[e.jsx(Z,{size:14})," مذكرة الأخصائي الاجتماعي"]}),e.jsxs("div",{className:"pr-2 border-r-2 border-yellow-200 space-y-1 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"الحالة:"})," ",s.swNote.situationChange]}),e.jsxs("p",{children:[e.jsx("strong",{children:"الإجراء:"})," ",s.swNote.actionsTaken.join(", ")]}),s.swNote.swNote&&e.jsxs("p",{className:"italic",children:['"',s.swNote.swNote,'"']})]}),s.swSign&&e.jsxs("p",{className:"text-gray-400 text-[10px] pt-1",children:["تم التوقيع بواسطة: ",s.swSign]})]})]}),ws=({visit:s,patient:r})=>{const{state:a,dispatch:t}=C(),[c,i]=m.useState(!1);if(!r)return null;const n=a.currentRole;let d,o,l=!1;switch(n){case f.Doctor:d=Se,o=s.doctorNote,l=!!s.doctorNote;break;case f.Nurse:d=we,o=s.nurseNote,l=!!s.nurseNote;break;case f.PhysicalTherapist:d=ve,o=s.ptNote,l=!!s.ptNote;break;case f.SocialWorker:d=Ne,o=s.swNote,l=!!s.swNote;break}const j=g=>{const p=a.staff.find(x=>x.الاسم.includes(""))||{الاسم:n};t({type:"SAVE_VISIT_NOTE",payload:{visitId:`${s.patientId}_${s.date}`,role:n,note:g,user:p.الاسم}}),i(!1)},b=g=>{const p=window.open("","_blank");if(p){p.document.write('<html><head><title>Visit Note</title><script src="https://cdn.tailwindcss.com"><\/script></head><body><div id="print-root"></div></body></html>'),p.document.close();const x=p.document.getElementById("print-root");x&&(je.createRoot(x).render(g),setTimeout(()=>{p.print(),p.close()},500))}},u=()=>{switch(s.status){case"Completed":return e.jsx(fe,{size:18,className:"text-green-500"});case"DoctorCompleted":return e.jsxs("div",{className:"flex items-center gap-1",title:"Doctor completed",children:[e.jsx(V,{size:16,className:"text-green-500"}),e.jsx(T,{size:16,className:"text-yellow-500"})]});case"NurseCompleted":return e.jsxs("div",{className:"flex items-center gap-1",title:"Nurse completed",children:[e.jsx(T,{size:16,className:"text-yellow-500"}),e.jsx(_,{size:16,className:"text-green-500"})]});default:return e.jsx(T,{size:18,className:"text-yellow-500"})}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center font-bold text-black bg-gray-100 border-2 border-gray-300",children:e.jsx(ge,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:r.nameAr}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.nationalId," | ",r.areaId]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold text-gray-600",children:[u(),e.jsx("span",{children:s.status})]})]}),c&&d?e.jsx(d,{initialData:o,onSave:j,onCancel:()=>i(!1)}):e.jsx(vs,{visit:s}),e.jsxs("div",{className:"border-t pt-3 flex justify-end items-center gap-2",children:[s.status==="Completed"&&e.jsxs("button",{onClick:()=>b(e.jsx(cs,{visit:s,patient:r})),className:"text-xs px-3 py-1 rounded-md text-gray-600 bg-gray-100 hover:bg-gray-200 flex items-center gap-1",children:[e.jsx(R,{size:14})," Print DN/RN"]}),s.ptNote&&e.jsxs("button",{onClick:()=>b(e.jsx(ds,{visit:s,patient:r})),className:"text-xs px-3 py-1 rounded-md text-gray-600 bg-gray-100 hover:bg-gray-200 flex items-center gap-1",children:[e.jsx(R,{size:14})," Print PT"]}),s.swNote&&e.jsxs("button",{onClick:()=>b(e.jsx(xs,{visit:s,patient:r})),className:"text-xs px-3 py-1 rounded-md text-gray-600 bg-gray-100 hover:bg-gray-200 flex items-center gap-1",children:[e.jsx(R,{size:14})," Print SW"]}),d&&!c&&e.jsxs("button",{onClick:()=>i(!0),className:"text-xs px-3 py-1 rounded-md text-blue-600 bg-blue-50 hover:bg-blue-100 flex items-center gap-1 flex-shrink-0",children:[e.jsx(He,{size:14})," ",l?"Edit Note":"Add Note"]})]})]})},Ss=()=>{const{state:s}=C(),r=new Date().toISOString().split("T")[0],a=s.visits.filter(t=>t.date===r);return e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-4",children:["Visits for ",r]}),s.teams.map(t=>{const c=a.filter(i=>i.teamId===t.id);return c.length===0?null:e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700 mb-3 border-b pb-2",children:t.name}),e.jsx("div",{className:"space-y-4",children:c.map(i=>e.jsx(ws,{visit:i,patient:s.patients.find(n=>n.nationalId===i.patientId)},i.patientId))})]},t.id)}),a.length===0&&e.jsx("div",{className:"text-center py-10 text-gray-500",children:e.jsx("p",{children:"No visits scheduled for today."})})]})},Cs=({visit:s,patient:r})=>{const a=`${r.areaId}, ${r.nameAr}`,t=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a)}`,c=`https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${encodeURIComponent(t)}`;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex items-center justify-between",dir:"rtl",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:r.nameAr}),e.jsxs("div",{className:"space-y-1 mt-2 text-sm text-gray-600",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(L,{size:14}),e.jsx("span",{children:r.areaId})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(E,{size:14}),e.jsx("span",{className:"font-mono",dir:"ltr",children:r.phone||"لا يوجد"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-shrink-0",children:[e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"p-3 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 transition-colors",title:"فتح في خرائط جوجل",children:e.jsx(L,{size:24})}),e.jsx("img",{src:c,alt:"QR Code",className:"w-24 h-24 rounded-md border"})]})]})},As=()=>{const{state:s}=C(),r=new Date().toISOString().split("T")[0],a=s.visits.filter(n=>n.date===r),t=a.reduce((n,d)=>{const o=s.patients.find(l=>l.nationalId===d.patientId);return o&&o.areaId&&(n[o.areaId]=n[o.areaId]||[]).push(d),n},{}),c=Object.keys(t).sort(),i=()=>{const n=window.open("","_blank");if(n){n.document.write('<html><head><title>Driver Route</title><script src="https://cdn.tailwindcss.com"><\/script></head><body><div id="print-root"></div></body></html>'),n.document.close();const d=n.document.getElementById("print-root");d&&(je.createRoot(d).render(e.jsx(ms,{visits:a,patients:s.patients,date:r})),setTimeout(()=>{n.print(),n.close()},500))}};return e.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6",dir:"rtl",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["مسار اليوم - ",r]}),a.length>0&&e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-4 py-2 text-sm rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300",children:[e.jsx(R,{size:16})," طباعة المسار"]})]}),c.length>0?e.jsx("div",{className:"space-y-6",children:c.map(n=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-3 pb-2 border-b",children:n}),e.jsx("div",{className:"space-y-3",children:t[n].map(d=>{const o=s.patients.find(l=>l.nationalId===d.patientId);return o?e.jsx(Cs,{visit:d,patient:o},d.patientId):null})})]},n))}):e.jsx("div",{className:"text-center py-16 text-gray-500",children:e.jsx("p",{className:"text-lg",children:"لا توجد زيارات مجدولة لهذا اليوم."})})]})})},ks=()=>{const{state:s}=C(),[r,a]=m.useState(!1),t=async()=>{a(!0),setTimeout(()=>{a(!1),window.location.reload()},1e3)};return e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(xe,{size:24,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"System Settings"}),e.jsx("p",{className:"text-gray-600",children:"Home Healthcare Management System Configuration"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(U,{size:20,className:"text-blue-600"}),"System Status"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx(fe,{size:20,className:"text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"System Online"}),e.jsx("p",{className:"text-sm text-green-600",children:"All services running"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(se,{size:20,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Data Loaded"}),e.jsx("p",{className:"text-sm text-blue-600",children:"JSON Bundle Active"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx(de,{size:20,className:"text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-800",children:"User Session"}),e.jsx("p",{className:"text-sm text-purple-600",children:"Authenticated"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(H,{size:20,className:"text-blue-600"}),"Data Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.patients.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Patients"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.staff.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Staff Members"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.areas.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Coverage Areas"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:s.visits.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Scheduled Visits"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(T,{size:20,className:"text-blue-600"}),"System Actions"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:t,disabled:r,className:"w-full md:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Refreshing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{size:18}),"Refresh Data"]})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Refresh the application to reload patient data and clear cache."})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Organization Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:"تجمع عسير الصحي – مستشفى الملك عبدالله ببيشة"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Aseer Health Cluster – King Abdullah Hospital, Bishah"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"الرعاية الصحية المنزلية"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Home Healthcare Department"})]}),e.jsx("div",{className:"pt-3 border-t border-gray-200",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Home Healthcare Management System - Version 1.0"})})]})]})]})},Ts=()=>e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-6",children:e.jsx(_e,{size:48,className:"text-blue-600 animate-spin mx-auto"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Loading Healthcare System"}),e.jsx("p",{className:"text-gray-600",children:"تحميل نظام الرعاية الصحية المنزلية..."})]})}),Es=({error:s,onRetry:r})=>e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-red-50 to-pink-100 p-4",children:e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-md w-full border border-red-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx($,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Loading Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"خطأ في تحميل البيانات"}),e.jsx("p",{className:"text-sm text-red-600 mb-6 bg-red-50 p-3 rounded-lg",children:s}),e.jsx("button",{onClick:r,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Try Again / إعادة المحاولة"})]})})}),ce=()=>{const[s,r]=m.useState(navigator.onLine);return m.useEffect(()=>{const a=()=>r(!0),t=()=>r(!1);return window.addEventListener("online",a),window.addEventListener("offline",t),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",t)}},[]),s?null:e.jsxs("div",{className:"fixed bottom-4 left-4 right-4 z-50 bg-orange-500 text-white p-3 rounded-lg shadow-lg flex items-center gap-2 animate-slide-up",children:[e.jsx(Ue,{size:20}),e.jsx("span",{className:"text-sm font-medium",children:"Offline Mode / وضع عدم الاتصال"})]})},Is=({activeView:s,setActiveView:r})=>{const{state:a,loading:t,error:c}=C(),[i,n]=m.useState(!1),[d,o]=m.useState("mobile");m.useEffect(()=>{const j=()=>{const g=window.innerWidth;g<768?o("mobile"):g<1024?o("tablet"):o("desktop")};j();let b;const u=()=>{clearTimeout(b),b=setTimeout(j,150)};return window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u),clearTimeout(b)}},[]),m.useEffect(()=>{d==="mobile"&&n(!1)},[s,d]);const l=()=>{window.location.reload()};return t?e.jsx(Ts,{}):c?e.jsx(Es,{error:c,onRetry:l}):a.currentRole===f.Driver?e.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 font-sans text-gray-800",children:[e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(re,{activeView:s,setActiveView:r}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 md:p-4 lg:p-6",children:e.jsx("div",{className:"animate-fade-in",children:e.jsx(As,{})})})]}),e.jsx(ce,{})]}):e.jsxs("div",{className:"flex min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 font-sans text-gray-800",children:[i&&d==="mobile"&&e.jsxs("div",{className:"fixed inset-0 z-40",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:()=>n(!1),"aria-label":"Close sidebar"}),e.jsxs("div",{className:"fixed left-0 top-0 bottom-0 w-80 max-w-[85vw] bg-white shadow-xl z-50 transform transition-transform duration-300 ease-out",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Filters & Search"}),e.jsx("button",{onClick:()=>n(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors touch-target-44","aria-label":"Close sidebar",children:e.jsx(O,{size:20})})]}),e.jsx("div",{className:"h-full overflow-hidden",children:e.jsx(ae,{})})]})]}),d!=="mobile"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ae,{})}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden min-w-0",children:[e.jsx(re,{activeView:s,setActiveView:r}),d==="mobile"&&e.jsx("div",{className:"border-b border-gray-200 p-3 bg-white/95 backdrop-blur-sm sticky top-[120px] z-30",children:e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium touch-target-44 shadow-lg w-full justify-center transition-all hover:bg-blue-700 active:scale-95","aria-label":"Open filters and search",children:[e.jsx(Ve,{size:18}),e.jsx("span",{children:"Filters & Search"}),a.selectedPatientIds.size>0&&e.jsx("span",{className:"bg-white/20 text-white px-2 py-1 rounded-full text-xs font-bold",children:a.selectedPatientIds.size})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-3 md:p-4 lg:p-6",children:e.jsxs("div",{className:"animate-fade-in",children:[s==="patients"&&e.jsx(ke,{}),s==="visits"&&e.jsx(Ss,{}),s==="settings"&&e.jsx(ks,{})]})})})]}),e.jsx(ce,{})]})},zs=({children:s})=>{const[r,a]=m.useState({highContrast:!1,reducedMotion:!1,largeText:!1,screenReader:!1,rtlMode:!0});m.useEffect(()=>{const n=()=>{const b=window.matchMedia("(prefers-contrast: high)").matches,u=window.matchMedia("(prefers-reduced-motion: reduce)").matches,g=window.matchMedia("(prefers-font-size: large)").matches,p=window.speechSynthesis!==void 0||document.body.getAttribute("role")==="application"||navigator.userAgent.includes("NVDA")||navigator.userAgent.includes("JAWS");a(x=>({...x,highContrast:b,reducedMotion:u,largeText:g,screenReader:p}))};n();const d=window.matchMedia("(prefers-contrast: high)"),o=window.matchMedia("(prefers-reduced-motion: reduce)"),l=()=>n(),j=()=>n();return d.addEventListener("change",l),o.addEventListener("change",j),()=>{d.removeEventListener("change",l),o.removeEventListener("change",j)}},[]),m.useEffect(()=>{const n=[];r.highContrast&&n.push("high-contrast"),r.reducedMotion&&n.push("reduced-motion"),r.largeText&&n.push("large-text"),r.screenReader&&n.push("screen-reader-active"),r.rtlMode&&n.push("rtl-mode"),document.documentElement.className=document.documentElement.className.split(" ").filter(d=>!["high-contrast","reduced-motion","large-text","screen-reader-active","rtl-mode"].includes(d)).concat(n).join(" "),document.documentElement.dir=r.rtlMode?"rtl":"ltr",document.documentElement.lang=r.rtlMode?"ar":"en"},[r]);const t=()=>e.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-50 focus:bg-blue-600 focus:text-white focus:p-4 focus:rounded-br-lg focus:shadow-lg",onFocus:n=>n.currentTarget.classList.remove("sr-only"),onBlur:n=>n.currentTarget.classList.add("sr-only"),children:r.rtlMode?"تخطي إلى المحتوى الرئيسي":"Skip to main content"}),c=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"live-region-polite","aria-live":"polite","aria-atomic":"false",className:"sr-only",role:"status"}),e.jsx("div",{id:"live-region-assertive","aria-live":"assertive","aria-atomic":"true",className:"sr-only",role:"alert"})]}),i=()=>{const[n,d]=m.useState(!1);return e.jsxs("div",{className:"fixed bottom-4 right-4 z-50",children:[e.jsx("button",{onClick:()=>d(!n),className:"bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-4 focus:ring-blue-300","aria-label":r.rtlMode?"إعدادات إمكانية الوصول":"Accessibility Settings","aria-expanded":n,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 7.5V9M15 11.5L21 12V14L15 13.5V15.5L21 16V18L15 17.5V19.5L21 20V22H3V20L9 19.5V17.5L3 18V16L9 15.5V13.5L3 14V12L9 11.5V9.5L3 10V8L9 9V7L3 7.5V5.5L9 6V4L3 4.5V3H21V5L15 5.5V7L21 7.5V9M12 8C10.34 8 9 9.34 9 11V22H11V19H13V22H15V11C15 9.34 13.66 8 12 8Z"})})}),n&&e.jsxs("div",{className:"absolute bottom-16 right-0 bg-white rounded-lg shadow-xl p-4 w-64 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 text-gray-800",children:r.rtlMode?"إعدادات إمكانية الوصول":"Accessibility Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx("input",{type:"checkbox",checked:r.highContrast,onChange:o=>a(l=>({...l,highContrast:o.target.checked})),className:"rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r.rtlMode?"التباين العالي":"High Contrast"})]}),e.jsxs("label",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx("input",{type:"checkbox",checked:r.reducedMotion,onChange:o=>a(l=>({...l,reducedMotion:o.target.checked})),className:"rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r.rtlMode?"تقليل الحركة":"Reduce Motion"})]}),e.jsxs("label",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx("input",{type:"checkbox",checked:r.largeText,onChange:o=>a(l=>({...l,largeText:o.target.checked})),className:"rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r.rtlMode?"نص كبير":"Large Text"})]}),e.jsxs("label",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx("input",{type:"checkbox",checked:r.rtlMode,onChange:o=>a(l=>({...l,rtlMode:o.target.checked})),className:"rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r.rtlMode?"وضع العربية (من اليمين لليسار)":"Arabic RTL Mode"})]})]})]})]})};return e.jsxs(e.Fragment,{children:[e.jsx(t,{}),e.jsx(c,{}),e.jsx("div",{id:"main-content",tabIndex:-1,children:s}),e.jsx(i,{})]})},Ps=()=>(m.useEffect(()=>{(()=>{document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="date"], input[type="time"], textarea, select').forEach(n=>{const d=n;d.classList.add("mobile-form-field"),d.classList.contains("touch-target-44")||(d.style.minHeight="44px")}),document.querySelectorAll("button").forEach(n=>{const d=n;d.classList.contains("touch-target-44")||(d.style.minHeight="44px",d.style.minWidth="44px"),!d.className.includes("mobile-btn")&&!d.className.includes("p-")&&(d.style.padding="12px 16px")}),document.querySelectorAll(".bg-white.rounded, .bg-white.rounded-lg, .bg-white.rounded-xl").forEach(n=>{const d=n;d.classList.contains("mobile-card")||d.classList.add("mobile-card")}),document.querySelectorAll(".fixed.inset-0").forEach(n=>{const d=n;if(d.classList.contains("z-50")){d.classList.add("mobile-modal");const o=d.querySelector(".bg-white");o&&!o.classList.contains("mobile-modal-content")&&o.classList.add("mobile-modal-content")}})})();const r=new MutationObserver(a=>{a.forEach(t=>{t.type==="childList"&&t.addedNodes.forEach(c=>{if(c.nodeType===Node.ELEMENT_NODE){const i=c;if((i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.tagName==="SELECT")&&i.classList.add("mobile-form-field"),i.tagName==="BUTTON"){const o=i;o.style.minHeight="44px",o.style.minWidth="44px"}i.querySelectorAll("input, textarea, select").forEach(o=>{o.classList.add("mobile-form-field")}),i.querySelectorAll("button").forEach(o=>{const l=o;l.style.minHeight="44px",l.style.minWidth="44px"})}})})});return r.observe(document.body,{childList:!0,subtree:!0}),()=>{r.disconnect()}},[]),m.useEffect(()=>{if(!document.querySelector('meta[name="viewport"]')){const r=document.createElement("meta");r.name="viewport",r.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(r)}},[]),m.useEffect(()=>{const s=document.createElement("style");return s.textContent=`
      /* Mobile touch improvements */
      * {
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        -webkit-touch-callout: none;
      }
      
      /* Prevent horizontal scroll on mobile */
      html, body {
        overflow-x: hidden;
        position: relative;
      }
      
      /* Smooth scrolling for mobile */
      html {
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
      }
      
      /* Improve button touch targets */
      button, input[type="button"], input[type="submit"] {
        min-height: 44px;
        min-width: 44px;
      }
      
      /* Improve link touch targets */
      a {
        min-height: 44px;
        display: inline-flex;
        align-items: center;
      }
      
      /* Improve form element appearance on mobile */
      input, textarea, select {
        font-size: 16px; /* Prevents zoom on iOS */
        border-radius: 8px;
      }
      
      /* Focus states for mobile */
      input:focus, textarea:focus, select:focus, button:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
      }
      
      /* Modal improvements for mobile */
      .mobile-modal {
        align-items: flex-end;
      }
      
      @media (min-width: 768px) {
        .mobile-modal {
          align-items: center;
        }
      }
      
      /* Hide scrollbars on mobile while maintaining functionality */
      .mobile-scroll-hide::-webkit-scrollbar {
        display: none;
      }
      
      .mobile-scroll-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      
      /* Improve checkbox and radio button touch targets */
      input[type="checkbox"], input[type="radio"] {
        min-width: 20px;
        min-height: 20px;
        transform: scale(1.2);
      }
      
      /* Improve table responsiveness */
      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      /* Mobile-first spacing */
      @media (max-width: 640px) {
        .container {
          padding-left: 16px;
          padding-right: 16px;
        }
        
        .modal-content {
          margin: 0;
          border-radius: 16px 16px 0 0;
        }
        
        .grid {
          gap: 16px;
        }
      }
    `,document.head.appendChild(s),()=>{document.head.removeChild(s)}},[]),m.useEffect(()=>{const s=()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100)};return window.addEventListener("orientationchange",s),()=>{window.removeEventListener("orientationchange",s)}},[]),null),Ds=({enabled:s=!1,showOverlay:r=!1})=>{const[a,t]=m.useState({}),[c,i]=m.useState(r),[n,d]=m.useState([]),o=m.useCallback(()=>{if(s)try{const g=performance.getEntriesByType("navigation")[0],p=performance.getEntriesByType("paint"),x={loadTime:g?g.loadEventEnd-g.loadEventStart:0,renderTime:performance.now()},y=p.find(v=>v.name==="first-contentful-paint");if(y&&(x.fcp=y.startTime),"memory"in performance){const v=performance.memory;x.memoryUsage=v.usedJSHeapSize/1024/1024}if("PerformanceObserver"in window){const v=new PerformanceObserver(w=>{const S=w.getEntries(),A=S[S.length-1];x.lcp=A.startTime,t(D=>({...D,lcp:A.startTime}))});try{v.observe({entryTypes:["largest-contentful-paint"]})}catch{console.warn("LCP observer not supported")}const k=new PerformanceObserver(w=>{let S=0;for(const A of w.getEntries())A.hadRecentInput||(S+=A.value);x.cls=S,t(A=>({...A,cls:S}))});try{k.observe({entryTypes:["layout-shift"]})}catch{console.warn("CLS observer not supported")}const I=new PerformanceObserver(w=>{for(const S of w.getEntries())x.fid=S.processingStart-S.startTime,t(A=>({...A,fid:S.processingStart-S.startTime}))});try{I.observe({entryTypes:["first-input"]})}catch{console.warn("FID observer not supported")}}t(v=>({...v,...x}))}catch(g){console.warn("Performance metrics collection failed:",g)}},[s]),l=m.useCallback(()=>{const g=[];a.fcp&&a.fcp>2500&&g.push("First Contentful Paint is slow (>2.5s)"),a.lcp&&a.lcp>4e3&&g.push("Largest Contentful Paint is slow (>4s)"),a.cls&&a.cls>.25&&g.push("Cumulative Layout Shift is high (>0.25)"),a.fid&&a.fid>300&&g.push("First Input Delay is high (>300ms)"),a.memoryUsage&&a.memoryUsage>50&&g.push("Memory usage is high (>50MB)"),d(g)},[a]);if(m.useEffect(()=>{if(!s)return;o();const g=setInterval(o,5e3),p=()=>{document.visibilityState==="visible"&&o()};return document.addEventListener("visibilitychange",p),()=>{clearInterval(g),document.removeEventListener("visibilitychange",p)}},[s,o]),m.useEffect(()=>{l()},[a,l]),m.useEffect(()=>{s&&Object.keys(a).length>0&&(console.log("📊 Performance Metrics:",a),n.length>0&&console.warn("⚠️ Performance Warnings:",n))},[s,a,n]),!s||!c)return null;const j=g=>g?`${g.toFixed(0)}ms`:"N/A",b=g=>g?`${g.toFixed(1)}MB`:"N/A",u=(g,p)=>{if(!p)return"text-gray-400";switch(g){case"fcp":return p<=1800?"text-green-600":p<=3e3?"text-yellow-600":"text-red-600";case"lcp":return p<=2500?"text-green-600":p<=4e3?"text-yellow-600":"text-red-600";case"cls":return p<=.1?"text-green-600":p<=.25?"text-yellow-600":"text-red-600";case"fid":return p<=100?"text-green-600":p<=300?"text-yellow-600":"text-red-600";default:return"text-gray-600"}};return e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80 max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Performance Monitor"]}),e.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600 text-xs",children:"✕"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(Be,{className:"w-3 h-3"}),"FCP"]}),e.jsx("span",{className:`text-xs font-mono ${u("fcp",a.fcp)}`,children:j(a.fcp)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-600 flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),"LCP"]}),e.jsx("span",{className:`text-xs font-mono ${u("lcp",a.lcp)}`,children:j(a.lcp)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"CLS"}),e.jsx("span",{className:`text-xs font-mono ${u("cls",a.cls)}`,children:a.cls?a.cls.toFixed(3):"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"FID"}),e.jsx("span",{className:`text-xs font-mono ${u("fid",a.fid)}`,children:j(a.fid)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Memory"}),e.jsx("span",{className:"text-xs font-mono text-gray-600",children:b(a.memoryUsage)})]})]}),n.length>0&&e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsxs("h4",{className:"text-xs font-semibold text-orange-600 mb-2 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),"Warnings"]}),e.jsx("ul",{className:"space-y-1",children:n.map((g,p)=>e.jsxs("li",{className:"text-xs text-orange-600",children:["• ",g]},p))})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3 mt-3",children:e.jsx("button",{onClick:o,className:"text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded hover:bg-blue-100 transition-colors",children:"Refresh Metrics"})})]})})};class Te extends m.Component{constructor(r){super(r),this.retryTimeoutId=null,this.reportError=(a,t)=>{try{const c={message:a.message,stack:a.stack,componentStack:t.componentStack,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,userId:"anonymous"},i=JSON.parse(localStorage.getItem("healthcare_app_errors")||"[]");i.push(c),localStorage.setItem("healthcare_app_errors",JSON.stringify(i.slice(-10)))}catch(c){console.error("Failed to report error:",c)}},this.handleRetry=()=>{this.setState(a=>({hasError:!1,error:void 0,errorInfo:void 0,retryCount:a.retryCount+1}))},this.handleReset=()=>{try{localStorage.removeItem("healthcare_app_cache"),sessionStorage.clear()}catch(a){console.warn("Failed to clear storage:",a)}window.location.reload()},this.handleHome=()=>{window.location.href="/"},this.copyErrorDetails=()=>{const a={error:this.state.error?.message,stack:this.state.error?.stack,componentStack:this.state.errorInfo?.componentStack,timestamp:new Date().toISOString(),retryCount:this.state.retryCount};navigator.clipboard.writeText(JSON.stringify(a,null,2)).then(()=>alert("Error details copied to clipboard")).catch(()=>console.warn("Failed to copy error details"))},this.state={hasError:!1,retryCount:0}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){console.error("🚨 Error caught by ErrorBoundary:",{error:r.message,stack:r.stack,componentStack:a.componentStack,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href}),this.setState({errorInfo:a}),this.reportError(r,a)}componentWillUnmount(){this.retryTimeoutId&&clearTimeout(this.retryTimeoutId)}render(){if(this.state.hasError){if(this.props.fallback){const r=this.props.fallback;return e.jsx(r,{error:this.state.error,retry:this.handleRetry})}return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-pink-100 p-4",children:e.jsx("div",{className:"max-w-lg w-full bg-white shadow-xl rounded-2xl p-6 border border-red-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-6",children:e.jsx(ye,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"System Error"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-700 mb-4",children:"خطأ في النظام"}),e.jsx("p",{className:"text-gray-600 mb-6 leading-relaxed",children:"An unexpected error occurred in the Healthcare Management System. Our team has been notified and is working to resolve this issue."}),e.jsx("p",{className:"text-gray-600 mb-6 text-sm",dir:"rtl",children:"حدث خطأ غير متوقع في نظام إدارة الرعاية الصحية. تم إشعار فريقنا وهو يعمل على حل هذه المشكلة."}),!1,e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"w-full flex items-center justify-center gap-2 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg",disabled:this.state.retryCount>=3,children:[e.jsx(te,{className:"w-5 h-5"}),this.state.retryCount>=3?"Maximum retries reached":"Try Again / إعادة المحاولة"]}),e.jsxs("button",{onClick:this.handleReset,className:"w-full flex items-center justify-center gap-2 bg-gray-600 text-white py-3 px-4 rounded-lg hover:bg-gray-700 transition-colors font-medium",children:[e.jsx(te,{className:"w-5 h-5"}),"Reset Application / إعادة تشغيل التطبيق"]}),e.jsxs("button",{onClick:this.handleHome,className:"w-full flex items-center justify-center gap-2 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors font-medium",children:[e.jsx(We,{className:"w-5 h-5"}),"Go to Home / الذهاب للرئيسية"]}),!1]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["If this issue persists, please contact IT Support at:",e.jsx("br",{}),e.jsx("span",{className:"font-mono",children:"support@kahbisha.health.sa"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",dir:"rtl",children:"إذا استمرت هذه المشكلة، يرجى الاتصال بالدعم الفني"})]})]})})})}return this.props.children}}const Ms=()=>{const[s,r]=m.useState("patients");return e.jsx(Is,{activeView:s,setActiveView:r})},Rs=()=>(m.useEffect(()=>{const s=Ze("App Initialization");Xe(),setTimeout(()=>{s(),console.log("✅ Home Healthcare Management System loaded successfully")},100)},[]),e.jsx(Te,{children:e.jsx(Ye,{children:e.jsxs(zs,{children:[e.jsx(Ps,{}),e.jsx(Ms,{}),e.jsx(Ds,{enabled:!1})]})})})),Ee=document.getElementById("root");if(!Ee)throw new Error("Could not find root element to mount to");const Ls=qe.createRoot(Ee);Ls.render(e.jsx(Ge.StrictMode,{children:e.jsx(Te,{children:e.jsx(Rs,{})})}));
